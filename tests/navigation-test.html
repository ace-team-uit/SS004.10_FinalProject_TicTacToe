<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .test-result { margin: 10px 0; padding: 10px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>Navigation System Test</h1>
    
    <div class="test-section">
        <h2>Test Navigation Tracking</h2>
        <button onclick="testNavigationTracking()">Test Navigation Tracking</button>
        <div id="navigation-results"></div>
    </div>

    <div class="test-section">
        <h2>Test Back Navigation</h2>
        <button onclick="testBackNavigation()">Test Back Navigation</button>
        <div id="back-results"></div>
    </div>

    <div class="test-section">
        <h2>Manual Test</h2>
        <p>Current Route: <span id="current-route">-</span></p>
        <p>Previous Route: <span id="previous-route">-</span></p>
        <button onclick="navigateToSelect()">Navigate to Select</button>
        <button onclick="navigateToGame()">Navigate to Game</button>
        <button onclick="navigateToSettings()">Navigate to Settings</button>
        <button onclick="navigateBack()">Navigate Back</button>
    </div>

    <script src="../shared/logic/navigation.js"></script>
    <script>
        // Mock AppStorage for testing
        window.AppStorage = {
            loadSettings: () => ({ gameIntroShown: true }),
            saveSettings: () => {}
        };

        // Mock loadScreen function
        window.loadScreen = (path) => {
            console.log('Loading screen:', path);
        };

        function updateDisplay() {
            document.getElementById('current-route').textContent = window.Navigation.getCurrentRoute() || '-';
            document.getElementById('previous-route').textContent = window.Navigation.getPreviousRoute() || '-';
        }

        function navigateToSelect() {
            window.Navigation.navigateTo('select');
            updateDisplay();
        }

        function navigateToGame() {
            window.Navigation.navigateTo('game');
            updateDisplay();
        }

        function navigateToSettings() {
            window.Navigation.navigateTo('settings');
            updateDisplay();
        }

        function navigateBack() {
            window.Navigation.navigateBack();
            updateDisplay();
        }

        function testNavigationTracking() {
            const results = document.getElementById('navigation-results');
            results.innerHTML = '';

            // Test 1: Navigate from select to settings
            window.Navigation.navigateTo('select');
            window.Navigation.navigateTo('settings');
            
            const test1Pass = window.Navigation.getPreviousRoute() === 'select';
            results.innerHTML += `<div class="test-result ${test1Pass ? 'pass' : 'fail'}">
                Test 1: Navigate from select to settings - ${test1Pass ? 'PASS' : 'FAIL'}
            </div>`;

            // Test 2: Navigate from game to settings
            window.Navigation.navigateTo('game');
            window.Navigation.navigateTo('settings');
            
            const test2Pass = window.Navigation.getPreviousRoute() === 'game';
            results.innerHTML += `<div class="test-result ${test2Pass ? 'pass' : 'fail'}">
                Test 2: Navigate from game to settings - ${test2Pass ? 'PASS' : 'FAIL'}
            </div>`;

            updateDisplay();
        }

        function testBackNavigation() {
            const results = document.getElementById('back-results');
            results.innerHTML = '';

            // Test 1: Back from settings (came from select)
            window.Navigation.navigateTo('select');
            window.Navigation.navigateTo('settings');
            const currentBeforeBack = window.Navigation.getCurrentRoute();
            const previousBeforeBack = window.Navigation.getPreviousRoute();
            
            window.Navigation.navigateBack();
            const currentAfterBack = window.Navigation.getCurrentRoute();
            
            const test1Pass = currentAfterBack === previousBeforeBack && currentAfterBack === 'select';
            results.innerHTML += `<div class="test-result ${test1Pass ? 'pass' : 'fail'}">
                Test 1: Back from settings (came from select) - ${test1Pass ? 'PASS' : 'FAIL'}
                <br>Before: current=${currentBeforeBack}, previous=${previousBeforeBack}
                <br>After: current=${currentAfterBack}
            </div>`;

            // Test 2: Back from settings (came from game)
            window.Navigation.navigateTo('game');
            window.Navigation.navigateTo('settings');
            const currentBeforeBack2 = window.Navigation.getCurrentRoute();
            const previousBeforeBack2 = window.Navigation.getPreviousRoute();
            
            window.Navigation.navigateBack();
            const currentAfterBack2 = window.Navigation.getCurrentRoute();
            
            const test2Pass = currentAfterBack2 === previousBeforeBack2 && currentAfterBack2 === 'game';
            results.innerHTML += `<div class="test-result ${test2Pass ? 'pass' : 'fail'}">
                Test 2: Back from settings (came from game) - ${test2Pass ? 'PASS' : 'FAIL'}
                <br>Before: current=${currentBeforeBack2}, previous=${previousBeforeBack2}
                <br>After: current=${currentAfterBack2}
            </div>`;

            updateDisplay();
        }

        // Initialize display
        updateDisplay();
    </script>
</body>
</html>
