<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Board Manager - Tic Tac Toe</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .demo-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .board {
        display: grid;
        gap: 2px;
        margin: 20px 0;
        background: #333;
        padding: 10px;
        border-radius: 8px;
      }
      .board-3x3 {
        grid-template-columns: repeat(3, 1fr);
      }
      .board-4x4 {
        grid-template-columns: repeat(4, 1fr);
      }
      .board-5x5 {
        grid-template-columns: repeat(5, 1fr);
      }
      .cell {
        width: 60px;
        height: 60px;
        background: white;
        border: none;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .cell:hover {
        background: #f0f0f0;
      }
      .cell.x {
        color: #e74c3c;
      }
      .cell.o {
        color: #3498db;
      }
      .btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      .btn:hover {
        background: #2980b9;
      }
      .status {
        background: #ecf0f1;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .winner {
        background: #2ecc71;
        color: white;
      }
      .draw {
        background: #f39c12;
        color: white;
      }
      pre {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>üéØ Demo Board Manager Module</h1>

    <div class="demo-section">
      <h2>Kh·ªüi t·∫°o Game</h2>
      <button class="btn" onclick="initGame(3)">3x3 Board</button>
      <button class="btn" onclick="initGame(4)">4x4 Board</button>
      <button class="btn" onclick="initGame(5)">5x5 Board</button>
      <button class="btn" onclick="resetGame()">Reset Game</button>

      <div class="status" id="gameStatus"><strong>Tr·∫°ng th√°i:</strong> Ch∆∞a kh·ªüi t·∫°o game</div>
    </div>

    <div class="demo-section">
      <h2>B√†n c·ªù</h2>
      <div id="boardContainer">
        <p>Ch·ªçn k√≠ch th∆∞·ªõc b√†n ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
      </div>
    </div>

    <div class="demo-section">
      <h2>Th√¥ng tin Game</h2>
      <div id="gameInfo">
        <p>Ch∆∞a c√≥ th√¥ng tin game</p>
      </div>
    </div>

    <div class="demo-section">
      <h2>Console Log</h2>
      <pre id="consoleLog">Ch·ªù thao t√°c...</pre>
    </div>

    <script src="shared/logic/board.js"></script>
    <script>
      let currentState = null;
      let currentSize = 3;

      // Mock console.log ƒë·ªÉ hi·ªÉn th·ªã trong UI
      const originalLog = console.log;
      const logContainer = document.getElementById("consoleLog");

      console.log = function (...args) {
        originalLog.apply(console, args);
        logContainer.textContent =
          args
            .map((arg) => (typeof arg === "object" ? JSON.stringify(arg, null, 2) : String(arg)))
            .join(" ") +
          "\n" +
          logContainer.textContent;
      };

      function initGame(size) {
        try {
          currentSize = size;
          currentState = BoardManager.initState(size);
          renderBoard();
          updateGameInfo();
          updateGameStatus();
          console.log(`üéÆ Kh·ªüi t·∫°o game ${size}x${size}:`, currentState);
        } catch (error) {
          console.error("‚ùå L·ªói kh·ªüi t·∫°o game:", error.message);
        }
      }

      function renderBoard() {
        const container = document.getElementById("boardContainer");
        const size = currentState.size;

        let html = `<div class="board board-${size}x${size}">`;

        for (let i = 0; i < size * size; i++) {
          const cellValue = currentState.board[i];
          let cellClass = "cell";
          let cellText = "";

          if (cellValue === 1) {
            cellClass += " x";
            cellText = "X";
          } else if (cellValue === 2) {
            cellClass += " o";
            cellText = "O";
          }

          html += `<button class="${cellClass}" onclick="makeMove(${i})">${cellText}</button>`;
        }

        html += "</div>";
        container.innerHTML = html;
      }

      function makeMove(index) {
        if (!currentState || currentState.gameStatus !== "playing") {
          console.log("‚ö†Ô∏è Game ƒë√£ k·∫øt th√∫c ho·∫∑c ch∆∞a kh·ªüi t·∫°o");
          return;
        }

        try {
          const newState = BoardManager.makeMove(currentState, index);
          currentState = newState;

          renderBoard();
          updateGameInfo();
          updateGameStatus();

          console.log(`üéØ N∆∞·ªõc ƒëi t·∫°i index ${index}:`, newState);

          // Ki·ªÉm tra k·∫øt qu·∫£
          if (newState.gameStatus === "won") {
            const winner = newState.currentPlayer === 1 ? "AI" : "Ng∆∞·ªùi ch∆°i";
            console.log(`üèÜ ${winner} th·∫Øng! D√≤ng th·∫Øng:`, newState.winningLine);
          } else if (newState.gameStatus === "draw") {
            console.log("ü§ù H√≤a! B√†n c·ªù ƒë√£ ƒë·∫ßy");
          }
        } catch (error) {
          console.error("‚ùå L·ªói th·ª±c hi·ªán n∆∞·ªõc ƒëi:", error.message);
        }
      }

      function resetGame() {
        if (currentState) {
          currentState = BoardManager.resetState(currentState);
          renderBoard();
          updateGameInfo();
          updateGameStatus();
          console.log("üîÑ Reset game:", currentState);
        }
      }

      function updateGameInfo() {
        const container = document.getElementById("gameInfo");
        if (!currentState) {
          container.innerHTML = "<p>Ch∆∞a c√≥ th√¥ng tin game</p>";
          return;
        }

        const coords =
          currentState.lastMove !== null
            ? BoardManager.indexToCoords(currentState.lastMove, currentState.size)
            : null;

        container.innerHTML = `
                <p><strong>K√≠ch th∆∞·ªõc:</strong> ${currentState.size}x${currentState.size}</p>
                <p><strong>ƒêi·ªÅu ki·ªán th·∫Øng:</strong> ${currentState.winLength} √¥ li√™n ti·∫øp</p>
                <p><strong>Ng∆∞·ªùi ch∆°i hi·ªán t·∫°i:</strong> ${currentState.currentPlayer === 1 ? "X (Ng∆∞·ªùi ch∆°i)" : "O (AI)"}</p>
                <p><strong>V√≤ng:</strong> ${currentState.round}</p>
                <p><strong>Tr√°i tim:</strong> ${currentState.hearts}</p>
                <p><strong>ƒêi·ªÉm s·ªë:</strong> Ng∆∞·ªùi ch∆°i: ${currentState.scores.player} | AI: ${currentState.scores.ai}</p>
                <p><strong>Tr·∫°ng th√°i:</strong> ${currentState.gameStatus}</p>
                <p><strong>N∆∞·ªõc ƒëi cu·ªëi:</strong> ${
                  currentState.lastMove !== null
                    ? `Index ${currentState.lastMove} (Row: ${coords.row}, Col: ${coords.col})`
                    : "Ch∆∞a c√≥"
                }</p>
                ${currentState.winningLine ? `<p><strong>D√≤ng th·∫Øng:</strong> ${JSON.stringify(currentState.winningLine)}</p>` : ""}
            `;
      }

      function updateGameStatus() {
        const container = document.getElementById("gameStatus");
        if (!currentState) {
          container.innerHTML = "<strong>Tr·∫°ng th√°i:</strong> Ch∆∞a kh·ªüi t·∫°o game";
          return;
        }

        let statusClass = "";
        let statusText = "";

        switch (currentState.gameStatus) {
          case "playing":
            statusText = `ƒêang ch∆°i - L∆∞·ª£t c·ªßa ${currentState.currentPlayer === 1 ? "X" : "O"}`;
            break;
          case "won":
            statusClass = "winner";
            const winner = currentState.currentPlayer === 1 ? "AI" : "Ng∆∞·ªùi ch∆°i";
            statusText = `üèÜ ${winner} th·∫Øng!`;
            break;
          case "draw":
            statusClass = "draw";
            statusText = "ü§ù H√≤a! B√†n c·ªù ƒë√£ ƒë·∫ßy";
            break;
          case "round_end":
            statusText = "V√≤ng k·∫øt th√∫c";
            break;
          default:
            statusText = "Tr·∫°ng th√°i kh√¥ng x√°c ƒë·ªãnh";
        }

        container.className = `status ${statusClass}`;
        container.innerHTML = `<strong>Tr·∫°ng th√°i:</strong> ${statusText}`;
      }

      // Kh·ªüi t·∫°o game m·∫∑c ƒë·ªãnh
      window.onload = function () {
        console.log("üöÄ Demo Board Manager ƒë√£ s·∫µn s√†ng!");
        console.log("üìö S·ª≠ d·ª•ng c√°c h√†m: initGame(size), makeMove(index), resetGame()");
        initGame(3);
      };
    </script>
  </body>
</html>
